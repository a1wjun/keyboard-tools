<template>
  <div>
    <b>KiCAD project generator:</b>
  </div>
  <div>
  Upload layout file generated by
  <b>
    <a href="http://www.keyboard-layout-editor.com">keyboard-layout-editor</a>
  </b>:
  <p/>
  </div>
  <div class="container">
    <input type="file" id="file" ref="file" v-on:change="uploadLayout()"/>
  </div>
</template>

<script>
import axios from 'axios'

export default {
  name: 'KicadHandler',
  methods: {
    uploadLayout() {
      var kle = require('@ijprest/kle-serial');

      let file = this.$refs.file.files[0];

      let reader = new FileReader();
      reader.readAsText(file, "UTF-8");
      reader.onload = evt => {
        var result = evt.target.result;
        var keyboard = kle.Serial.deserialize(JSON.parse(result));
        console.log(keyboard);
        axios
          .post(`${process.env.VUE_APP_API_URL}/api/pcb`, keyboard)
          .then(response => (console.log(response.data)));
      }
      reader.onerror = evt => {
        console.error(evt);
      }
    }
  }
};
</script>

<style scoped>
</style>
